"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.getRecords=getRecords,exports.getProjectClients=getProjectClients,exports.recordClient=recordClient,exports.getRecordClient=getRecordClient,exports.clearProjectRecord=clearProjectRecord,exports.removeClientBySn=removeClientBySn;var _fs=_interopRequireDefault(require("fs")),_path=_interopRequireDefault(require("path")),_index=require("./index"),_config=_interopRequireDefault(require("../config"));function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function getRecords(e){let t={records:{}};try{t=JSON.parse(_fs.default.readFileSync(e).toString())}catch(e){_index.colorconsole.error(`读取hap-toolkit-client-records.json文件出错: ${e.message}`)}return t}function writeRecords(e,t){_fs.default.writeFileSync(e,JSON.stringify(t,null,2))}function getProjectClients(e){const t=_config.default.projectPath;let r=e.records;r=r instanceof Object?r:{};const o=r[t];return o&&o instanceof Array?o:[]}function recordClient(e,t,r){const o=_path.default.dirname(e),i=_config.default.projectPath;let n;if((0,_index.mkdirsSync)(o),_fs.default.existsSync(e)){n=getRecords(e);let o=getProjectClients(n);for(r&&r(`writeClientLogFile(): before: ${JSON.stringify(n.records)}`),o=o.filter(e=>e.ip!==t.ip||e.port!==t.port);o.length>4;)o.shift();n.records[i]=o}else n={records:{}},n.records[i]=[];n.records[i].push(t),writeRecords(e,n),r&&r(`writeClientLogFile(): after: ${JSON.stringify(n.records)}`)}function getRecordClient(e,t,r){if(_fs.default.existsSync(e)){return getProjectClients(getRecords(e)).find(e=>e.sn===t&&e.ip===r&&e.port)}}function clearProjectRecord(e){if(_fs.default.existsSync(e)){const t=getRecords(e),r=_config.default.projectPath;t.records[r]=[],writeRecords(e,t),_index.colorconsole.info("### App Server ### 清空调试设备记录")}else _index.colorconsole.info("### App Server ### 没有需要清空的调试设备记录")}function removeClientBySn(e,t,r){if(_fs.default.existsSync(e)){const o=_config.default.projectPath,i=getRecords(e),n=i.records,c=getProjectClients(i);r&&r(`_removeItemFromClientLogFile(): before: ${JSON.stringify(n)}`),n[o]=c.filter(e=>e.sn!==t),writeRecords(e,i),r&&r(`_removeItemFromClientLogFile(): after: ${JSON.stringify(n)}`)}}
//# sourceMappingURL=record-client.js.map
